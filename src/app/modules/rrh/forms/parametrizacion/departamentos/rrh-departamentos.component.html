<div class="page-toolbar">
  <button mat-stroked-button color="primary" (click)="exportarCSV()" [disabled]="!hasData()">
    <mat-icon>file_download</mat-icon>
    CSV
  </button>
  <button mat-stroked-button color="primary" (click)="exportarPDF()" [disabled]="!hasData()">
    <mat-icon>picture_as_pdf</mat-icon>
    PDF
  </button>
  <button mat-icon-button (click)="loadData()" [disabled]="loading()" aria-label="Refrescar">
    <mat-icon>refresh</mat-icon>
  </button>
</div>

<mat-card class="rrh-departamentos">
  <mat-card-header>
    <mat-icon class="title-icon">apartment</mat-icon>
    <mat-card-title>{{ titulo() }}</mat-card-title>
    <mat-card-subtitle>Gesti√≥n de Departamentos</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <div class="records-line">{{ filteredData().length }} registros</div>
    <div class="header-actions">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Filtrar registros...</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input matInput (input)="aplicarFiltro($any($event.target).value)" />
      </mat-form-field>
      <span class="spacer"></span>
      <button mat-raised-button color="primary" class="btn-gradient" (click)="onNuevo()">
        <mat-icon>add</mat-icon>
        Nuevo
      </button>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Nombre</mat-label>
        <input
          matInput
          placeholder="Nombre del departamento"
          [ngModel]="formNombre()"
          (ngModelChange)="onNombreChange($event)"
          [disabled]="loading()"
          style="text-transform: uppercase"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Estado</mat-label>
        <mat-select
          [ngModel]="formEstado()"
          (ngModelChange)="formEstado.set($event)"
          [disabled]="loading()"
        >
          <mat-option value="A">Activo</mat-option>
          <mat-option value="I">Inactivo</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="form-actions">
        <button mat-raised-button color="accent" (click)="onGuardar()" [disabled]="loading()">
          <mat-icon>save</mat-icon>
          Guardar
        </button>
        <button mat-stroked-button (click)="onCancelar()" [disabled]="loading()">
          <mat-icon>close</mat-icon>
          Cancelar
        </button>
        <button mat-button (click)="onVolver()">
          <mat-icon>arrow_back</mat-icon>
          Volver
        </button>
      </div>
    </div>

    @if (hasData()) {
      <div class="table-wrapper">
        <table class="mat-elevation-z2 w-100 nature-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Estado</th>
              <th class="acciones">Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (row of pagedData(); track row.codigo) {
              <tr>
                <td>{{ row?.nombre }}</td>
                <td>{{ estadoLabel(row?.estado) }}</td>
                <td class="acciones">
                  <button
                    mat-icon-button
                    color="primary"
                    class="action-btn edit-btn"
                    (click)="onEditar(row)"
                    [disabled]="loading()"
                    aria-label="Editar"
                  >
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    color="warn"
                    class="action-btn delete-btn"
                    (click)="onEliminar(row)"
                    [disabled]="loading()"
                    aria-label="Eliminar"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>

        <div class="paginator">
          <mat-paginator
            [length]="filteredData().length"
            [pageSize]="pageSize()"
            [pageIndex]="pageIndex()"
            [pageSizeOptions]="[5, 10, 20, 50]"
            (page)="onPageChange($event)"
          >
          </mat-paginator>
        </div>
      </div>
    } @else {
      <div class="empty-state">
        <mat-icon>inbox</mat-icon>
        <p>No hay departamentos registrados.</p>
      </div>
    }
  </mat-card-content>
</mat-card>

<style>
  .page-toolbar {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
  }
  .rrh-departamentos .header-actions {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }
  .title-icon {
    margin-right: 8px;
    color: #8b5cf6;
  }
  .search-field {
    flex: 1;
    min-width: 320px;
  }
  .spacer {
    flex: 1;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 12px;
    margin-bottom: 12px;
    align-items: end;
  }
  .form-actions {
    display: flex;
    gap: 8px;
  }

  .rrh-departamentos .table-wrapper {
    overflow: auto;
  }
  .rrh-departamentos table {
    border-collapse: separate;
    border-spacing: 0;
  }
  .rrh-departamentos th,
  .rrh-departamentos td {
    padding: 10px 12px;
  }
  .rrh-departamentos thead tr {
    background: transparent;
  }
  .rrh-departamentos thead th {
    background: linear-gradient(
      135deg,
      rgba(102, 126, 234, 0.85) 0%,
      rgba(118, 75, 162, 0.85) 100%
    );
    color: #fff;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
    text-align: center;
  }
  .rrh-departamentos thead th:first-child {
    border-top-left-radius: 8px;
  }
  .rrh-departamentos thead th:last-child {
    border-top-right-radius: 8px;
  }
  .rrh-departamentos thead th:not(:last-child) {
    border-right: 2px solid rgba(255, 255, 255, 0.15);
  }
  .nature-table tbody tr:nth-child(even) {
    background: #f9f9ff;
  }
  .rrh-departamentos td.acciones,
  .rrh-departamentos th.acciones {
    width: 120px;
    text-align: right;
  }

  .rrh-departamentos .empty-state {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #777;
  }
  .w-100 {
    width: 100%;
  }
  .paginator {
    margin-top: 8px;
  }

  /* Botones estilo Naturaleza */
  .btn-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: #fff !important;
  }
  .btn-gradient mat-icon {
    color: #fff !important;
  }
  .btn-gradient:hover {
    box-shadow:
      0 4px 6px -1px rgba(102, 126, 234, 0.2),
      0 2px 4px -1px rgba(102, 126, 234, 0.1);
  }

  .action-btn.edit-btn .mat-icon {
    color: #4facfe;
  }
  .action-btn.delete-btn .mat-icon {
    color: #ff758c;
  }
  .action-btn.edit-btn:hover {
    background: rgba(79, 172, 254, 0.12);
  }
  .action-btn.delete-btn:hover {
    background: rgba(255, 117, 140, 0.12);
  }
</style>
