<div class="exters-shell">
	<h2>
		<mat-icon>people</mat-icon>
		EXTR - Registros de Externos
	</h2>
	<div class="toolbar">
		<mat-form-field appearance="outline" class="filter-field">
			<mat-label>Buscar registros</mat-label>
			<mat-icon matPrefix>search</mat-icon>
			<input matInput (keyup)="applyFilter($any($event.target).value)" placeholder="Buscar por cualquier campo..." />
			<mat-hint>Busca por cédula, nombre, correo, etc.</mat-hint>
		</mat-form-field>

		<div class="action-buttons">
			<button mat-raised-button color="accent" (click)="exportarCSV()" [disabled]="loading() || totalRegistros() === 0" matTooltip="Exportar a Excel">
				<mat-icon>file_download</mat-icon>
				Excel
			</button>
			<button mat-raised-button color="accent" (click)="exportarPDF()" [disabled]="loading() || totalRegistros() === 0" matTooltip="Exportar a PDF">
				<mat-icon>picture_as_pdf</mat-icon>
				PDF
			</button>
		</div>

		<div class="total-info">
			<mat-icon>info</mat-icon>
			Total: {{totalRegistros()}} registros
		</div>
	</div>

	<div class="table-wrapper" *ngIf="!loading(); else loadingTpl">
		<!-- Botones de navegación scroll -->
		<div class="scroll-controls" *ngIf="isScrolled()">
			<button mat-mini-fab color="primary" (click)="scrollToTop()" matTooltip="Ir arriba">
				<mat-icon>keyboard_arrow_up</mat-icon>
			</button>
			<button mat-mini-fab color="primary" (click)="scrollToLeft()" matTooltip="Ir al inicio">
				<mat-icon>keyboard_arrow_left</mat-icon>
			</button>
		</div>

		<div class="table-container" #tableContainer>
			<table mat-table [dataSource]="dataSource" matSort [trackBy]="trackRow" class="mat-elevation-z1">
				<ng-container *ngFor="let col of displayedColumns" [matColumnDef]="col">
					<th mat-header-cell *matHeaderCellDef mat-sort-header>{{ col }}</th>
					<td mat-cell *matCellDef="let element">{{ formatCellValue(element[col], col) }}</td>
				</ng-container>

				<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
				<tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowClick(row)"></tr>
			</table>
		</div>
		<mat-paginator
			[pageSize]="pageSize"
			[pageIndex]="pageIndex"
			[length]="totalRegistros()"
			[pageSizeOptions]="[10, 20, 50, 100]"
			(page)="pageChanged($event)"
			showFirstLastButtons>
		</mat-paginator>
		<div class="error" *ngIf="errorMsg()">
			<mat-icon>error</mat-icon>
			{{ errorMsg() }}
		</div>
	</div>
	<ng-template #loadingTpl>
		<div class="loading-center">
			<div class="loading-content">
				<mat-spinner diameter="48"></mat-spinner>
				<p>Cargando registros...</p>
			</div>
		</div>
	</ng-template>
</div>
