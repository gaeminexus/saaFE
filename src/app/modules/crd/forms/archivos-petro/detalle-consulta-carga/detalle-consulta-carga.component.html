<div class="detalle-consulta-container">
  <!-- Header con bot\u00f3n volver y t\u00edtulo -->
  <div class="page-header">
    <button mat-icon-button (click)="volverAtras()" class="back-button" matTooltip="Volver">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 class="page-title">
      <mat-icon class="title-icon">description</mat-icon>
      Detalle de Archivo
    </h1>
  </div>

  <!-- Header con filtros (solo lectura) -->
  <div class="search-header">
    <div class="filters-box">
      <mat-form-field appearance="fill" class="filter-field">
        <mat-label>Año</mat-label>
        <input matInput [value]="anioSeleccionado" readonly>
        <mat-icon matPrefix>calendar_today</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-field">
        <mat-label>Mes</mat-label>
        <input matInput [value]="mesSeleccionado ? meses[mesSeleccionado - 1].nombre : ''" readonly>
        <mat-icon matPrefix>event</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-field">
        <mat-label>Filial</mat-label>
        <input matInput [value]="getFilialNombre()" readonly>
        <mat-icon matPrefix>business</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-field">
        <mat-label>Archivo</mat-label>
        <input matInput [value]="nombreArchivo" readonly>
        <mat-icon matPrefix>insert_drive_file</mat-icon>
      </mat-form-field>
    </div>
  </div>

  <!-- Loading spinner -->
  @if (isLoading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Cargando datos...</p>
    </div>
  }

  <!-- Área de contenido -->
  @if (!isLoading && cargaArchivo) {
    <div class="content-area">
      <!-- Información del archivo -->
      <div class="file-info-section">
        <mat-card class="file-info-card">
          <mat-card-header>
            <mat-icon mat-card-avatar class="avatar-icon">insert_drive_file</mat-icon>
            <mat-card-title>Información del Archivo</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="file-details">
              <div class="file-detail-item">
                <mat-icon>description</mat-icon>
                <span class="label">Nombre del Archivo:</span>
                <span class="value">{{ nombreArchivo }}</span>
              </div>

              <div class="file-detail-item">
                <mat-icon>person</mat-icon>
                <span class="label">Usuario de Carga:</span>
                <span class="value">{{ cargaArchivo.usuarioCarga.nombre || 'N/A' }}</span>
              </div>

              <div class="file-detail-item">
                <mat-icon>event</mat-icon>
                <span class="label">Fecha de Carga:</span>
                <span class="value">{{ cargaArchivo.fechaCarga | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>

              <div class="file-detail-item">
                <mat-icon>folder</mat-icon>
                <span class="label">Ruta del Archivo:</span>
                <span class="value">{{ cargaArchivo.rutaArchivo || 'N/A' }}</span>
              </div>
            </div>

            <button mat-raised-button color="primary" class="download-button" (click)="descargarArchivo()">
              <mat-icon>download</mat-icon>
              Descargar Archivo
            </button>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Paneles de resultados agrupados por aporte -->
      @if (aporteAgrupados.length > 0) {
        <div class="results-section">
      <mat-card>
        <mat-card-header>
          <mat-icon mat-card-avatar class="avatar-icon">table_chart</mat-icon>
          <mat-card-title>Datos de la Carga</mat-card-title>
          <mat-card-subtitle>{{ totalRegistros }} registros en {{ aporteAgrupados.length }} aportes</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <mat-accordion multi>
            @for (aporte of aporteAgrupados; track aporte.codigoAporte) {
              <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title class="custom-panel-title">
                  <div class="title-left">
                    <mat-icon class="aporte-icon">receipt_long</mat-icon>
                    <span class="aporte-codigo">{{ aporte.codigoAporte }}</span>
                    <span class="separator">-</span>
                    <span class="aporte-descripcion">{{ aporte.nombreAporte }}</span>
                  </div>
                  <div class="title-center">
                    <span class="total-descontado-badge">
                      <mat-icon>payments</mat-icon>
                      Total: {{ aporte.totales.totalDescontado | number:'1.2-2' }}
                    </span>
                  </div>
                  <div class="title-right">
                    <button
                      mat-icon-button
                      (click)="exportarAporteACSV(aporte.codigoAporte, $event)"
                      matTooltip="Exportar a CSV"
                      class="export-csv-button"
                      color="accent"
                    >
                      <mat-icon>download</mat-icon>
                    </button>
                    <span class="registro-count">{{ aporte.totalParticipes }} partícipes</span>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>

              <!-- Totales del aporte -->
              <div class="totales-section">
                <h4>
                  <mat-icon>assessment</mat-icon>
                  Totales del Aporte
                </h4>
                <div class="totales-grid">
                  <div class="total-item clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'saldoActual')">
                    <span class="total-label">Saldo Actual</span>
                    <span class="total-valor">{{ aporte.totales.saldoActual | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'interesAnual')">
                    <span class="total-label">Interés Anual</span>
                    <span class="total-valor">{{ aporte.totales.interesAnual | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'valorSeguro')">
                    <span class="total-label">Valor Seguro</span>
                    <span class="total-valor">{{ aporte.totales.valorSeguro | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item destacado clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'totalDescontar')">
                    <span class="total-label">Total a Descontar</span>
                    <span class="total-valor">{{ aporte.totales.totalDescontar | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'capitalDescontado')">
                    <span class="total-label">Capital Descontado</span>
                    <span class="total-valor">{{ aporte.totales.capitalDescontado | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'interesDescontado')">
                    <span class="total-label">Interés Descontado</span>
                    <span class="total-valor">{{ aporte.totales.interesDescontado | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'seguroDescontado')">
                    <span class="total-label">Seguro Descontado</span>
                    <span class="total-valor">{{ aporte.totales.seguroDescontado | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item destacado clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'totalDescontado')">
                    <span class="total-label">Total Descontado</span>
                    <span class="total-valor">{{ aporte.totales.totalDescontado | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item no-descontado clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'capitalNoDescontado')">
                    <span class="total-label">Capital No Descontado</span>
                    <span class="total-valor">{{ aporte.totales.capitalNoDescontado | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item no-descontado clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'interesNoDescontado')">
                    <span class="total-label">Interés No Descontado</span>
                    <span class="total-valor">{{ aporte.totales.interesNoDescontado | number:'1.2-2' }}</span>
                  </div>
                  <div class="total-item no-descontado clickable" (click)="filtrarPorTotal(aporte.codigoAporte, 'desgravamenNoDescontado')">
                    <span class="total-label">Desgravamen No Descontado</span>
                    <span class="total-valor">{{ aporte.totales.desgravamenNoDescontado | number:'1.2-2' }}</span>
                  </div>
                </div>
              </div>

              <!-- Tabla de partícipes -->
              <div class="table-container">
                <table mat-table [dataSource]="aporte.participes" matSort class="participes-table">
                  <!-- Código -->
                  <ng-container matColumnDef="codigo">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Código</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.codigoPetro }}</td>
                  </ng-container>

                  <!-- Nombre -->
                  <ng-container matColumnDef="nombre">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.nombre }}</td>
                  </ng-container>

                  <!-- Plazo Inicial -->
                  <ng-container matColumnDef="plazoInicial">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Plazo Inicial</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.plazoInicial }}</td>
                  </ng-container>

                  <!-- Saldo Actual -->
                  <ng-container matColumnDef="saldoActual">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Saldo Actual</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.saldoActual | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Meses Plazo -->
                  <ng-container matColumnDef="mesesPlazo">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Meses Plazo</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.mesesPlazo }}</td>
                  </ng-container>

                  <!-- Interés Anual -->
                  <ng-container matColumnDef="interesAnual">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Interés Anual</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.interesAnual | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Valor Seguro -->
                  <ng-container matColumnDef="valorSeguro">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Valor Seguro</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.valorSeguro | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Total Descontar -->
                  <ng-container matColumnDef="montoDescontar">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Descontar</th>
                    <td mat-cell *matCellDef="let participe" class="destacado">{{ participe.montoDescontar | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Capital Descontado -->
                  <ng-container matColumnDef="capitalDescontado">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Capital Desc.</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.capitalDescontado | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Interés Descontado -->
                  <ng-container matColumnDef="interesDescontado">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Interés Desc.</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.interesDescontado | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Seguro Descontado -->
                  <ng-container matColumnDef="seguroDescontado">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Seguro Desc.</th>
                    <td mat-cell *matCellDef="let participe">{{ participe.seguroDescontado | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Total Descontado -->
                  <ng-container matColumnDef="totalDescontado">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Desc.</th>
                    <td mat-cell *matCellDef="let participe" class="destacado">{{ participe.totalDescontado | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Capital No Descontado -->
                  <ng-container matColumnDef="capitalNoDescontado">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Capital No Desc.</th>
                    <td mat-cell *matCellDef="let participe" class="no-descontado">{{ participe.capitalNoDescontado | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Interés No Descontado -->
                  <ng-container matColumnDef="interesNoDescontado">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Interés No Desc.</th>
                    <td mat-cell *matCellDef="let participe" class="no-descontado">{{ participe.interesNoDescontado | number:'1.2-2' }}</td>
                  </ng-container>

                  <!-- Desgravamen No Descontado -->
                  <ng-container matColumnDef="desgravamenNoDescontado">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Desgravamen No Desc.</th>
                    <td mat-cell *matCellDef="let participe" class="no-descontado">{{ participe.desgravamenNoDescontado | number:'1.2-2' }}</td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
              </div>
              </mat-expansion-panel>
            }
          </mat-accordion>

          <!-- Totales Generales -->
          <div class="totales-generales-section">
            <div class="totales-generales-header">
              <mat-icon>summarize</mat-icon>
              <h3>Totales Generales de la Carga</h3>
            </div>
            <div class="totales-grid">
              <div class="total-item">
                <span class="total-label">Saldo Actual</span>
                <span class="total-valor">{{ totalesGenerales.saldoActual | number:'1.2-2' }}</span>
              </div>
              <div class="total-item">
                <span class="total-label">Interés Anual</span>
                <span class="total-valor">{{ totalesGenerales.interesAnual | number:'1.2-2' }}</span>
              </div>
              <div class="total-item">
                <span class="total-label">Valor Seguro</span>
                <span class="total-valor">{{ totalesGenerales.valorSeguro | number:'1.2-2' }}</span>
              </div>
              <div class="total-item">
                <span class="total-label">Total a Descontar</span>
                <span class="total-valor">{{ totalesGenerales.totalDescontar | number:'1.2-2' }}</span>
              </div>
              <div class="total-item">
                <span class="total-label">Capital Descontado</span>
                <span class="total-valor">{{ totalesGenerales.capitalDescontado | number:'1.2-2' }}</span>
              </div>
              <div class="total-item">
                <span class="total-label">Interés Descontado</span>
                <span class="total-valor">{{ totalesGenerales.interesDescontado | number:'1.2-2' }}</span>
              </div>
              <div class="total-item">
                <span class="total-label">Seguro Descontado</span>
                <span class="total-valor">{{ totalesGenerales.seguroDescontado | number:'1.2-2' }}</span>
              </div>
              <div class="total-item">
                <span class="total-label">Total Descontado</span>
                <span class="total-valor">{{ totalesGenerales.totalDescontado | number:'1.2-2' }}</span>
              </div>
              <div class="total-item no-descontado">
                <span class="total-label">Capital No Descontado</span>
                <span class="total-valor">{{ totalesGenerales.capitalNoDescontado | number:'1.2-2' }}</span>
              </div>
              <div class="total-item no-descontado">
                <span class="total-label">Interés No Descontado</span>
                <span class="total-valor">{{ totalesGenerales.interesNoDescontado | number:'1.2-2' }}</span>
              </div>
              <div class="total-item no-descontado">
                <span class="total-label">Desgravamen No Descontado</span>
                <span class="total-valor">{{ totalesGenerales.desgravamenNoDescontado | number:'1.2-2' }}</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Sección de Novedades -->
      @if (mostrarNovedades() && novedadesAgrupadas().length > 0) {
        <mat-card class="novedades-card">
          <mat-card-header>
            <mat-icon mat-card-avatar class="avatar-icon">report_problem</mat-icon>
            <mat-card-title>Gestión de Novedades</mat-card-title>
            <mat-card-subtitle>Registros que requieren atención o corrección</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="novedades-section">
              <mat-tab-group
                class="novedades-tabs"
                [(selectedIndex)]="tabNovedadSeleccionado"
                (selectedIndexChange)="onTabNovedadChange($event)">

                <!-- Tab Partícipes -->
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon class="tab-icon">person</mat-icon>
                    Partícipes
                    @if (contarNovedades('PARTICIPE') > 0) {
                      <span class="tab-count badge-warning">
                        ({{ contarNovedades('PARTICIPE') }})
                      </span>
                    }
                  </ng-template>

                  <div class="tab-content">
                    @for (novedad of novedadesFiltradas; track novedad.novedad.codigo) {
                      <mat-card class="novedad-card" [class.expanded]="expandedNovedad() === novedad.novedad.codigo">
                        <div class="custom-header" (click)="toggleExpansion(novedad.novedad.codigo)"
                             style="display: flex; flex-direction: row; align-items: center; padding: 1rem; cursor: pointer;">
                          <mat-icon class="novedad-icon" [style.color]="novedad.novedad.colorChip"
                                    style="margin-right: 1rem; font-size: 24px; width: 24px; height: 24px;">{{ novedad.novedad.icono }}</mat-icon>
                          <span class="novedad-title" style="flex: 1; margin: 0; padding: 0; font-size: 1rem; font-weight: 500;">{{ novedad.novedad.descripcion }}</span>
                          <div class="header-actions" style="display: flex; align-items: center; gap: 0.5rem;">
                            <span class="badge" [style.background-color]="novedad.novedad.colorChip"
                                  style="padding: 4px 12px; border-radius: 16px; font-size: 13px; font-weight: 600; color: white; min-width: 28px; text-align: center;">{{ novedad.total }}</span>
                            <mat-icon class="expand-icon">{{ expandedNovedad() === novedad.novedad.codigo ? 'expand_less' : 'expand_more' }}</mat-icon>
                          </div>
                        </div>

                        @if (loadingNovedad() === novedad.novedad.codigo) {
                          <mat-card-content>
                            <div style="display: flex; justify-content: center; align-items: center; padding: 2rem;">
                              <mat-spinner diameter="40"></mat-spinner>
                              <span style="margin-left: 1rem; color: #666;">Cargando registros...</span>
                            </div>
                          </mat-card-content>
                        }

                        @if (expandedNovedad() === novedad.novedad.codigo) {
                          <mat-card-content>
                            <table mat-table [dataSource]="getPagedRegistros(novedad.registros, novedad.novedad.codigo)" class="novedad-table">
                              <!-- Código Petroamazonas -->
                              <ng-container matColumnDef="codigoPetro">
                                <th mat-header-cell *matHeaderCellDef>Código Petro</th>
                                <td mat-cell *matCellDef="let element">{{ element.codigoPetro }}</td>
                              </ng-container>

                              <!-- Nombre -->
                              <ng-container matColumnDef="nombre">
                                <th mat-header-cell *matHeaderCellDef>Nombre</th>
                                <td mat-cell *matCellDef="let element">{{ element.nombre }}</td>
                              </ng-container>

                              <!-- Acciones -->
                              <ng-container matColumnDef="acciones">
                                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                                <td mat-cell *matCellDef="let element">
                                  <button
                                    mat-raised-button
                                    color="primary"
                                    (click)="corregirRegistro(element)"
                                    class="btn-corregir">
                                    <mat-icon>{{ novedad.novedad.codigo === 1 ? 'search' : 'build' }}</mat-icon>
                                    {{ novedad.novedad.codigo === 1 ? 'Coincidencias' : 'Corregir' }}
                                  </button>
                                </td>
                              </ng-container>

                              <tr mat-header-row *matHeaderRowDef="['codigoPetro', 'nombre', 'acciones']"></tr>
                              <tr mat-row *matRowDef="let row; columns: ['codigoPetro', 'nombre', 'acciones'];"></tr>
                            </table>

                            <mat-paginator
                              [length]="novedad.registros.length"
                              [pageSize]="pageSize"
                              [pageIndex]="getPageIndex(novedad.novedad.codigo)"
                              [pageSizeOptions]="pageSizeOptions"
                              (page)="onPageChange($event, novedad.novedad.codigo)"
                              showFirstLastButtons>
                            </mat-paginator>
                          </mat-card-content>
                        }
                      </mat-card>
                    } @empty {
                      <div class="empty-state">
                        <mat-icon>check_circle</mat-icon>
                        <p>No hay novedades de partícipes</p>
                      </div>
                    }
                  </div>
                </mat-tab>

                <!-- Tab Descuentos -->
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon class="tab-icon">attach_money</mat-icon>
                    Descuentos
                    @if (contarNovedades('DESCUENTO') > 0) {
                      <span class="tab-count badge-warning">
                        {{ contarNovedades('DESCUENTO') }}
                      </span>
                    }
                  </ng-template>

                  <div class="tab-content">
                    @for (novedad of novedadesFiltradas; track novedad.novedad.codigo) {
                      <mat-card class="novedad-card" [class.expanded]="expandedNovedad() === novedad.novedad.codigo">
                        <mat-card-header (click)="toggleExpansion(novedad.novedad.codigo)">
                          <mat-icon class="novedad-icon" [style.color]="novedad.novedad.colorChip">
                            {{ novedad.novedad.icono }}
                          </mat-icon>
                          <mat-card-title>{{ novedad.novedad.descripcion }}</mat-card-title>
                          <div class="header-actions">
                            <span class="badge" [class]="'badge-' + novedad.novedad.severidad">
                              {{ novedad.total }}
                            </span>
                            <mat-icon class="expand-icon">
                              {{ expandedNovedad() === novedad.novedad.codigo ? 'expand_less' : 'expand_more' }}
                            </mat-icon>
                          </div>
                        </mat-card-header>

                        @if (expandedNovedad() === novedad.novedad.codigo) {
                          <mat-card-content>
                            <table mat-table [dataSource]="novedad.registros" class="novedad-table">
                              <!-- Código Petroamazonas -->
                              <ng-container matColumnDef="codigoPetro">
                                <th mat-header-cell *matHeaderCellDef>Código Petro</th>
                                <td mat-cell *matCellDef="let element">{{ element.codigoPetro }}</td>
                              </ng-container>

                              <!-- Nombre -->
                              <ng-container matColumnDef="nombre">
                                <th mat-header-cell *matHeaderCellDef>Nombre</th>
                                <td mat-cell *matCellDef="let element">{{ element.nombre }}</td>
                              </ng-container>

                              <!-- Acciones -->
                              <ng-container matColumnDef="acciones">
                                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                                <td mat-cell *matCellDef="let element">
                                  <button
                                    mat-raised-button
                                    color="primary"
                                    (click)="corregirRegistro(element)"
                                    class="btn-corregir">
                                    <mat-icon>{{ novedad.novedad.codigo === 1 ? 'search' : 'build' }}</mat-icon>
                                    {{ novedad.novedad.codigo === 1 ? 'Coincidencias' : 'Corregir' }}
                                  </button>
                                </td>
                              </ng-container>

                              <tr mat-header-row *matHeaderRowDef="['codigoPetro', 'nombre', 'acciones']"></tr>
                              <tr mat-row *matRowDef="let row; columns: ['codigoPetro', 'nombre', 'acciones'];"></tr>
                            </table>

                            <mat-paginator
                              [length]="novedad.registros.length"
                              [pageSize]="pageSize"
                              [pageIndex]="getPageIndex(novedad.novedad.codigo)"
                              [pageSizeOptions]="pageSizeOptions"
                              (page)="onPageChange($event, novedad.novedad.codigo)"
                              showFirstLastButtons>
                            </mat-paginator>
                          </mat-card-content>
                        }
                      </mat-card>
                    } @empty {
                      <div class="empty-state">
                        <mat-icon>check_circle</mat-icon>
                        <p>No hay novedades de descuentos</p>
                      </div>
                    }
                  </div>
                </mat-tab>

              </mat-tab-group>
            </div>
          </mat-card-content>
        </mat-card>
      }

      <!-- Tarjeta para procesar archivo -->
      @if (mostrarProcesar()) {
        <div class="process-file-section">
          <mat-card class="process-card">
            <mat-card-header>
              <mat-icon mat-card-avatar class="avatar-icon process-icon">settings</mat-icon>
              <mat-card-title>Procesar Archivo</mat-card-title>
              <mat-card-subtitle>Ejecutar proceso de validación y carga final</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              @if (archivoYaProcesado()) {
                <!-- Mensaje de archivo procesado -->
                <div class="file-processed-state">
                  <mat-icon class="success-icon">check_circle</mat-icon>
                  <h3>¡Archivo Procesado Exitosamente!</h3>
                  <p>El archivo ha sido procesado y está listo para su uso</p>
                </div>
              } @else {
                <div class="process-content">
                  <div class="process-info">
                    <mat-icon>info_outline</mat-icon>
                    <p>
                      El proceso validará y procesará los datos cargados<br>
                      <strong>Este proceso será programado por el equipo de backend</strong>
                    </p>
                  </div>

                  <button
                    mat-raised-button
                    color="accent"
                    class="process-button"
                    [disabled]="aporteAgrupados.length === 0"
                    (click)="procesarArchivo()">
                    <mat-icon>send</mat-icon>
                    <span>Procesar Archivo</span>
                  </button>
                </div>
              }
            </mat-card-content>
          </mat-card>
        </div>
      }
        </div>
      }
    </div>
  }
</div>
