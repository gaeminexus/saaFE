<div class="solicitud-pagos">
  <mat-card>
    <mat-card-title>Procesos · Solicitud Pagos</mat-card-title>
    <mat-card-content>
      <div class="filters">
        <mat-form-field appearance="outline">
          <mat-label>Fecha inicio</mat-label>
          <input matInput [matDatepicker]="d1" (dateChange)="fechaInicio.set($event.value)" />
          <mat-datepicker-toggle matSuffix [for]="d1"></mat-datepicker-toggle>
          <mat-datepicker #d1></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Fecha fin</mat-label>
          <input matInput [matDatepicker]="d2" (dateChange)="fechaFin.set($event.value)" />
          <mat-datepicker-toggle matSuffix [for]="d2"></mat-datepicker-toggle>
          <mat-datepicker #d2></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full">
          <mat-label>Proveedor</mat-label>
          <input matInput (input)="proveedor.set($any($event.target).value)" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Estado</mat-label>
          <mat-select (selectionChange)="estado.set($any($event.value))">
            <mat-option [value]="''">Todos</mat-option>
            <mat-option value="PENDIENTE">PENDIENTE</mat-option>
            <mat-option value="APROBADO">APROBADO</mat-option>
            <mat-option value="RECHAZADO">RECHAZADO</mat-option>
            <mat-option value="GENERADO">GENERADO</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="actions">
        <button mat-stroked-button color="basic" (click)="limpiar()">
          <mat-icon>refresh</mat-icon>
          Limpiar filtros
        </button>
      </div>

      <div class="table-wrapper">
        <table mat-table [dataSource]="filtered()" class="mat-elevation-z1 full-width">
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let r; let i = index">
              <mat-checkbox
                [checked]="selected().has(i)"
                (change)="toggleOne(i, $any($event).checked)"
              ></mat-checkbox>
            </td>
          </ng-container>

          <ng-container matColumnDef="numero">
            <th mat-header-cell *matHeaderCellDef>Número</th>
            <td mat-cell *matCellDef="let r">{{ r.numero }}</td>
          </ng-container>

          <ng-container matColumnDef="proveedor">
            <th mat-header-cell *matHeaderCellDef>Proveedor</th>
            <td mat-cell *matCellDef="let r">{{ r.proveedor }}</td>
          </ng-container>

          <ng-container matColumnDef="documento">
            <th mat-header-cell *matHeaderCellDef>Documento</th>
            <td mat-cell *matCellDef="let r">{{ r.documento }}</td>
          </ng-container>

          <ng-container matColumnDef="fecha">
            <th mat-header-cell *matHeaderCellDef>Fecha</th>
            <td mat-cell *matCellDef="let r">{{ r.fecha }}</td>
          </ng-container>

          <ng-container matColumnDef="valor">
            <th mat-header-cell *matHeaderCellDef>Valor</th>
            <td mat-cell *matCellDef="let r">{{ r.valor | number : '1.2-2' }}</td>
          </ng-container>

          <ng-container matColumnDef="estado">
            <th mat-header-cell *matHeaderCellDef>Estado</th>
            <td mat-cell *matCellDef="let r">{{ r.estado }}</td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="[
              'select',
              'numero',
              'proveedor',
              'documento',
              'fecha',
              'valor',
              'estado'
            ]"
          ></tr>
          <tr
            mat-row
            *matRowDef="
              let row;
              columns: ['select', 'numero', 'proveedor', 'documento', 'fecha', 'valor', 'estado']
            "
          ></tr>
        </table>
      </div>

      <div class="totals">
        Seleccionadas: <strong>{{ selectedCount() }}</strong> — Total:
        <strong>{{ selectedTotal() | number : '1.2-2' }}</strong>
      </div>

      <div class="actions">
        <button
          mat-flat-button
          color="primary"
          (click)="aprobarSeleccionados()"
          [disabled]="loading() || selectedCount() === 0"
        >
          <mat-icon>task_alt</mat-icon>
          Aprobar seleccionadas
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
