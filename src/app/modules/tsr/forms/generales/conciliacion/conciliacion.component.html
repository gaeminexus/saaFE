<section class="page">
  <header class="page-header">
    <h2>Generales · Conciliación</h2>
    <div class="actions">
      <button mat-raised-button color="primary" (click)="conciliarPendientes()">
        <mat-icon>done_all</mat-icon>
        Conciliar pendientes
      </button>
    </div>
  </header>

  <div class="filters">
    <mat-form-field appearance="outline">
      <mat-label>Banco</mat-label>
      <input matInput [value]="banco()" (input)="banco.set($any($event.target).value)" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Cuenta</mat-label>
      <input matInput [value]="cuenta()" (input)="cuenta.set($any($event.target).value)" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Fecha desde</mat-label>
      <input matInput [matDatepicker]="dpd" (dateChange)="fechaDesde.set($event.value)" />
      <mat-datepicker-toggle matSuffix [for]="dpd"></mat-datepicker-toggle>
      <mat-datepicker #dpd></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Fecha hasta</mat-label>
      <input matInput [matDatepicker]="dph" (dateChange)="fechaHasta.set($event.value)" />
      <mat-datepicker-toggle matSuffix [for]="dph"></mat-datepicker-toggle>
      <mat-datepicker #dph></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Referencia</mat-label>
      <input matInput [value]="referencia()" (input)="referencia.set($any($event.target).value)" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Monto mínimo</mat-label>
      <input
        matInput
        type="number"
        [value]="montoMin() ?? ''"
        (input)="montoMin.set(+$any($event.target).value || null)"
      />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Monto máximo</mat-label>
      <input
        matInput
        type="number"
        [value]="montoMax() ?? ''"
        (input)="montoMax.set(+$any($event.target).value || null)"
      />
    </mat-form-field>

    <button mat-stroked-button color="primary" class="buscar" (click)="buscar()">
      <mat-icon>search</mat-icon>
      Buscar
    </button>
  </div>

  <div class="totals">
    <span>Total registros: {{ totalRegistros() }}</span>
    <span>Total movimientos: {{ totalMonto() | number : '1.2-2' }}</span>
    <span>Pendiente por conciliar: {{ totalPendiente() | number : '1.2-2' }}</span>
  </div>

  <table mat-table [dataSource]="items()" class="mat-elevation-z1">
    <ng-container matColumnDef="sel">
      <th mat-header-cell *matHeaderCellDef>Sel</th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox [checked]="row.conciliado" (change)="toggleConciliado(row)"></mat-checkbox>
      </td>
    </ng-container>

    <ng-container matColumnDef="fecha">
      <th mat-header-cell *matHeaderCellDef>Fecha</th>
      <td mat-cell *matCellDef="let row">{{ row.fecha | date : 'dd/MM/yyyy' }}</td>
    </ng-container>

    <ng-container matColumnDef="banco">
      <th mat-header-cell *matHeaderCellDef>Banco</th>
      <td mat-cell *matCellDef="let row">{{ row.banco }}</td>
    </ng-container>

    <ng-container matColumnDef="cuenta">
      <th mat-header-cell *matHeaderCellDef>Cuenta</th>
      <td mat-cell *matCellDef="let row">{{ row.cuenta }}</td>
    </ng-container>

    <ng-container matColumnDef="referencia">
      <th mat-header-cell *matHeaderCellDef>Referencia</th>
      <td mat-cell *matCellDef="let row">{{ row.referencia }}</td>
    </ng-container>

    <ng-container matColumnDef="descripcion">
      <th mat-header-cell *matHeaderCellDef>Descripción</th>
      <td mat-cell *matCellDef="let row">{{ row.descripcion }}</td>
    </ng-container>

    <ng-container matColumnDef="monto">
      <th mat-header-cell *matHeaderCellDef>Monto</th>
      <td mat-cell *matCellDef="let row" class="num">{{ row.monto | number : '1.2-2' }}</td>
    </ng-container>

    <ng-container matColumnDef="estado">
      <th mat-header-cell *matHeaderCellDef>Estado</th>
      <td mat-cell *matCellDef="let row">{{ row.conciliado ? 'CONCILIADO' : 'PENDIENTE' }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</section>
