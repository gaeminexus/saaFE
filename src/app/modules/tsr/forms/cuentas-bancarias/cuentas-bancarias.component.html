<div class="cuentas-admin">
  <div class="page-header">
    <div class="icon-wrap">
      <mat-icon>account_balance</mat-icon>
    </div>
    <div class="title-wrap">
      <h2 class="title">Cuentas Bancarias</h2>
      <p class="subtitle">Administración y consulta por Banco</p>
    </div>
    <div class="actions">
      <button mat-stroked-button color="primary" (click)="exportCuentasCSV()">
        <mat-icon>table_rows</mat-icon>
        CSV
      </button>
      <button mat-stroked-button color="primary" (click)="exportCuentasPDF()">
        <mat-icon>picture_as_pdf</mat-icon>
        PDF
      </button>
    </div>
  </div>

  <div class="listas">
    <section class="panel bancos">
      <header>
        <h3>Bancos</h3>
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Buscar</mat-label>
          <input matInput (input)="aplicarFiltroBancos($event.target.value)" />
        </mat-form-field>
      </header>

      <table mat-table [dataSource]="bancosPage()" class="mat-elevation-z1 bancos-table">
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>DESCRIPCION</th>
          <td
            mat-cell
            *matCellDef="let row"
            (click)="seleccionarBanco(row)"
            [class.selected]="bancoSeleccionado()?.codigo === row.codigo"
          >
            {{ row.nombre }}
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumnsBancos"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsBancos"></tr>
      </table>

      <mat-paginator
        [length]="bancosTotal()"
        [pageSize]="bancosPageSize()"
        [pageSizeOptions]="[5, 8, 10]"
        (page)="onBancosPageChange($event)"
      ></mat-paginator>
    </section>

    <section class="panel cuentas">
      <header>
        <h3>Cuentas Bancarias</h3>
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Buscar</mat-label>
          <input matInput (input)="aplicarFiltroCuentas($event.target.value)" />
        </mat-form-field>
      </header>

      <table mat-table [dataSource]="cuentasPage()" class="mat-elevation-z1 cuentas-table">
        <ng-container matColumnDef="numero">
          <th mat-header-cell *matHeaderCellDef>CUENTA</th>
          <td mat-cell *matCellDef="let row">{{ row.numeroCuenta }}</td>
        </ng-container>

        <ng-container matColumnDef="tipo">
          <th mat-header-cell *matHeaderCellDef>TIPO CUENTA</th>
          <td mat-cell *matCellDef="let row">{{ mostrarTipoCuenta(row) }}</td>
        </ng-container>

        <ng-container matColumnDef="saldo">
          <th mat-header-cell *matHeaderCellDef>SALDO INICIAL</th>
          <td mat-cell *matCellDef="let row">{{ row.saldoInicial | number: '1.2-2' }}</td>
        </ng-container>

        <ng-container matColumnDef="cuentaContable">
          <th mat-header-cell *matHeaderCellDef>CUENTA CONTABLE</th>
          <td mat-cell *matCellDef="let row">{{ row.planCuenta?.cuenta }}</td>
        </ng-container>

        <ng-container matColumnDef="fIngreso">
          <th mat-header-cell *matHeaderCellDef>F. INGRESO</th>
          <td mat-cell *matCellDef="let row">{{ row.fechaIngreso }}</td>
        </ng-container>

        <ng-container matColumnDef="fDesactiva">
          <th mat-header-cell *matHeaderCellDef>F. DESACTIV.</th>
          <td mat-cell *matCellDef="let row">{{ row.fechaInactivo }}</td>
        </ng-container>

        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef>ESTADO</th>
          <td mat-cell *matCellDef="let row">{{ mostrarEstado(row) }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumnsCuentas"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsCuentas"></tr>
      </table>

      <mat-paginator
        [length]="cuentasTotal()"
        [pageSize]="cuentasPageSize()"
        [pageSizeOptions]="[5, 8, 10]"
        (page)="onCuentasPageChange($event)"
      ></mat-paginator>
    </section>
  </div>

  <section class="form-panel">
    <header>
      <h3>Información general de la cuenta bancaria</h3>
    </header>

    <div class="form-grid">
      <div class="row">
        <mat-form-field appearance="outline">
          <mat-label>Banco</mat-label>
          <input matInput [value]="bancoSeleccionado()?.nombre || ''" disabled />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Fecha de apertura</mat-label>
          <input matInput type="date" [(ngModel)]="fechaApertura" />
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="outline">
          <mat-label>Cuenta</mat-label>
          <input matInput [(ngModel)]="numeroCuenta" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Titular</mat-label>
          <input matInput [(ngModel)]="titular" />
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="outline">
          <mat-label>Tipo Cuenta</mat-label>
          <mat-select [(ngModel)]="tipoCuentaSel">
            <mat-option *ngFor="let r of tiposCuenta()" [value]="r">{{ r.descripcion }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Oficial de cuenta</mat-label>
          <input matInput [(ngModel)]="oficialCuenta" />
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="outline">
          <mat-label>Saldo Inicial</mat-label>
          <input matInput type="number" [(ngModel)]="saldoInicial" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Cuenta Contable</mat-label>
          <input matInput placeholder="Seleccione ..." [(ngModel)]="cuentaContableNombre" />
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="outline" class="span-2">
          <mat-label>Observaciones</mat-label>
          <input matInput [(ngModel)]="observaciones" />
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="outline">
          <mat-label>Estado</mat-label>
          <mat-select [(ngModel)]="estado">
            <mat-option [value]="1">Activo</mat-option>
            <mat-option [value]="0">Inactivo</mat-option>
          </mat-select>
        </mat-form-field>
        <div></div>
      </div>

      <div class="row row-4">
        <mat-form-field appearance="outline">
          <mat-label>Teléfono 1</mat-label>
          <input matInput [(ngModel)]="telefono1" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Teléfono 2</mat-label>
          <input matInput [(ngModel)]="telefono2" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Celular</mat-label>
          <input matInput [(ngModel)]="celular" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Fax</mat-label>
          <input matInput [(ngModel)]="fax" />
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="outline" class="span-2">
          <mat-label>Dirección</mat-label>
          <input matInput [(ngModel)]="direccion" />
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="outline" class="span-2">
          <mat-label>E-mail</mat-label>
          <input matInput type="email" [(ngModel)]="email" />
        </mat-form-field>
      </div>

      <div class="form-actions">
        <button mat-raised-button color="primary" [disabled]="!hasBanco()">Guardar</button>
        <button mat-stroked-button color="accent">Limpiar</button>
      </div>
    </div>
  </section>
</div>
