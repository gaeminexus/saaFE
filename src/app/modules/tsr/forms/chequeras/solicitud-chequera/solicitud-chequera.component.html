<div class="solicitud-page">
  <div class="page-header">
    <div class="icon-wrap"><mat-icon>library_add</mat-icon></div>
    <div class="title-wrap">
      <h2 class="title">Solicitud de Chequera</h2>
      <p class="subtitle">Generación de pedidos por banco y cuenta</p>
    </div>
    <div class="actions">
      <!-- Acciones de cabecera opcionales -->
    </div>
  </div>

  <div class="form-card">
    <header class="panel-header">
      <h3>Datos de la solicitud</h3>
    </header>
    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Banco</mat-label>
        <mat-select [(ngModel)]="bancoSel" (selectionChange)="onBancoChange($event.value)">
          <mat-option [value]="null">Seleccione ...</mat-option>
          <mat-option *ngFor="let b of bancos()" [value]="b">{{ b.nombre }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Cuenta Bancaria</mat-label>
        <mat-select [(ngModel)]="cuentaSel">
          <mat-option [value]="null">Seleccione ...</mat-option>
          <mat-option *ngFor="let c of cuentasFiltradas()" [value]="c">{{
            c.numeroCuenta
          }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Fecha de solicitud</mat-label>
        <input matInput type="date" [(ngModel)]="fechaSolicitud" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Número de cheques</mat-label>
        <input matInput type="number" min="1" [(ngModel)]="numeroCheques" />
      </mat-form-field>
    </div>

    <div class="form-actions">
      <button
        mat-raised-button
        color="primary"
        (click)="solicitar()"
        [disabled]="!formValido() || loading()"
      >
        <mat-icon>{{ estaEditando() ? 'save' : 'playlist_add' }}</mat-icon>
        {{ estaEditando() ? 'Actualizar' : 'Solicitar' }}
      </button>
      <button
        mat-raised-button
        color="warn"
        (click)="limpiarFormulario()"
        style="margin-left: 10px"
        *ngIf="estaEditando()"
      >
        <mat-icon>cancel</mat-icon>
        Cancelar
      </button>
      <span class="msg ok" *ngIf="successMsg()">{{ successMsg() }}</span>
      <span class="msg err" *ngIf="errorMsg()">{{ errorMsg() }}</span>
    </div>
  </div>
</div>

<!-- Grid de Solicitudes -->
<div class="tabla-container" style="margin-top: 20px">
  <h3>Solicitudes de Chequera</h3>

  @if (loading()) {
    <div style="text-align: center; padding: 20px">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }

  @if (!loading()) {
    <table mat-table [dataSource]="solicitudesPage()" class="solicitudes-table">
      <!-- Código -->
      <ng-container matColumnDef="codigo">
        <th mat-header-cell *matHeaderCellDef>Código</th>
        <td mat-cell *matCellDef="let row">{{ row.codigo }}</td>
      </ng-container>

      <!-- Banco -->
      <ng-container matColumnDef="banco">
        <th mat-header-cell *matHeaderCellDef>Banco</th>
        <td mat-cell *matCellDef="let row">{{ mostrarBanco(row) }}</td>
      </ng-container>

      <!-- Cuenta -->
      <ng-container matColumnDef="cuenta">
        <th mat-header-cell *matHeaderCellDef>Cuenta</th>
        <td mat-cell *matCellDef="let row">{{ mostrarCuenta(row) }}</td>
      </ng-container>

      <!-- Fecha Solicitud -->
      <ng-container matColumnDef="fechaSolicitud">
        <th mat-header-cell *matHeaderCellDef>Fecha Solicitud</th>
        <td mat-cell *matCellDef="let row">{{ mostrarFechaSolicitud(row) }}</td>
      </ng-container>

      <!-- Número de Cheques -->
      <ng-container matColumnDef="numeroCheques">
        <th mat-header-cell *matHeaderCellDef>Nº Cheques</th>
        <td mat-cell *matCellDef="let row">{{ row.numeroCheques }}</td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let row">{{ mostrarEstado(row) }}</td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let row">
          <button mat-icon-button color="primary" (click)="editar(row)" matTooltip="Editar">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="eliminar(row)" matTooltip="Eliminar">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [length]="totalSolicitudes()"
      [pageSize]="pageSize()"
      [pageSizeOptions]="[5, 10, 20, 50]"
      (page)="onPageChange($event)"
      showFirstLastButtons
    ></mat-paginator>
  }
</div>
